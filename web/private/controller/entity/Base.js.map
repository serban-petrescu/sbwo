{"version":3,"sources":["Base.es6.js"],"names":["oDtFormat","getDateTimeInstance","style","extend","getBaseApiUrl","getReadApiUrl","sId","getUpdateApiUrl","getRestoreApiUrl","getDeleteApiUrl","getEntityListRoute","onInit","buildViewModel","edit","draft","id","loaded","setModel","onSave","sUrl","getModel","getProperty","put","getData","onSaveSuccess","oData","setData","setProperty","remove","getInstance","getHash","onRestore","onRestoreSuccess","onReset","onRead","oViewModel","get","onReadSuccess","onDelete","del","onDeleteSuccess","window","history","go","onValueChanged","prototype","apply","arguments","saveDraft","onRouteMatched","oEvent","getParameter","oModel","onToggleEdit","restoreDraft","onNotFoundError","getRouter","getTargets","display","data","time","Date","getTime","sHash","save","then","oDataModel","oBundle","getResourceBundle","fnOnConfirm","fnOnDecline","fnShowMsg","sMsg","getText","format","show","icon","Icon","INFORMATION","title","actions","Action","YES","NO","onClose","sAction","load","iDelay"],"mappings":"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","file":"Base.js","sourcesContent":["import Base from \"spet/sbwo/web/private/controller/Base\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport MessageBox from \"sap/m/MessageBox\";\r\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\r\nimport DraftService from \"spet/sbwo/web/private/util/DraftService\";\r\nimport DateFormat from \"sap/ui/core/format/DateFormat\";\r\n\r\nvar oDtFormat = DateFormat.getDateTimeInstance({style: \"short\"});\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.entity.Base\", {\r\n\r\n    getBaseApiUrl() {\r\n        return \"\";\r\n    },\r\n\r\n    getReadApiUrl(sId) {\r\n        return this.getBaseApiUrl() + \"/read/\" + sId;\r\n    },\r\n\r\n    getUpdateApiUrl(sId) {\r\n        return this.getBaseApiUrl() + \"/update/\" + sId;\r\n    },\r\n\r\n    getRestoreApiUrl(sId) {\r\n        return this.getBaseApiUrl() + \"/restore/\" + sId;\r\n    },\r\n\r\n    getDeleteApiUrl(sId) {\r\n        return this.getBaseApiUrl() + \"/delete/\" + sId;\r\n    },\r\n\r\n    getEntityListRoute() {\r\n        return null;\r\n    },\r\n\r\n    onInit() {\r\n        this.buildViewModel({\r\n            edit: false,\r\n            draft: \"Clear\",\r\n            id: null,\r\n            loaded: false\r\n        });\r\n        this.setModel(new JSONModel({}), \"data\");\r\n    },\r\n\r\n    onSave() {\r\n        var sUrl = this.getUpdateApiUrl(this.getModel(\"view\").getProperty(\"/id\"));\r\n        this.put(sUrl, this.getModel(\"data\").getData(), this.onSaveSuccess);\r\n    },\r\n\r\n    onSaveSuccess(oData) {\r\n        this.getModel(\"data\").setData(oData);\r\n        this.getModel(\"view\").setProperty(\"/edit\", false);\r\n        this.getModel(\"view\").setProperty(\"/draft\", \"Clear\");\r\n        DraftService.remove(HashChanger.getInstance().getHash());\r\n    },\r\n\r\n    onRestore() {\r\n        var sUrl = this.getRestoreApiUrl(this.getModel(\"view\").getProperty(\"/id\"));\r\n        this.put(sUrl, {}, this.onRestoreSuccess);\r\n    },\r\n\r\n    onRestoreSuccess(oData) {\r\n        this.getModel(\"data\").setData(oData);\r\n    },\r\n\r\n    onReset() {\r\n        this.onRead();\r\n        DraftService.remove(HashChanger.getInstance().getHash());\r\n    },\r\n\r\n    onRead() {\r\n        var oViewModel = this.getModel(\"view\"),\r\n            sUrl = this.getReadApiUrl(oViewModel.getProperty(\"/id\"));\r\n        oViewModel.setProperty(\"/loaded\", false);\r\n        this.get(sUrl, this.onReadSuccess);\r\n    },\r\n\r\n    onReadSuccess(oData) {\r\n        this.getModel(\"data\").setData(oData);\r\n        this.getModel(\"view\").setProperty(\"/draft\", \"Clear\");\r\n        this.getModel(\"view\").setProperty(\"/loaded\", true);\r\n    },\r\n\r\n    onDelete() {\r\n        var sUrl = this.getDeleteApiUrl(this.getModel(\"view\").getProperty(\"/id\"));\r\n        this.del(sUrl, this.onDeleteSuccess);\r\n    },\r\n\r\n    onDeleteSuccess() {\r\n        this.getModel(\"view\").setProperty(\"/draft\", \"Clear\");\r\n        window.history.go(-1);\r\n    },\r\n\r\n    onValueChanged() {\r\n        Base.prototype.onValueChanged.apply(this, arguments);\r\n        this.saveDraft();\r\n    },\r\n\r\n    onRouteMatched(oEvent) {\r\n        var sId = oEvent.getParameter(\"arguments\").id,\r\n            oModel = this.getModel(\"view\");\r\n        oModel.setProperty(\"/id\", sId);\r\n        oModel.setProperty(\"/edit\", false);\r\n        oModel.setProperty(\"/draft\", \"Clear\");\r\n        this.onRead();\r\n    },\r\n\r\n    onToggleEdit() {\r\n        var oModel = this.getModel(\"view\");\r\n        if (oModel.getProperty(\"/edit\")) {\r\n            this.restoreDraft();\r\n        }\r\n        else {\r\n            oModel.setProperty(\"/draft\", \"Clear\");\r\n            this.onRead();\r\n        }\r\n    },\r\n\r\n    onNotFoundError(/* oXhr */) {\r\n        this.getRouter().getTargets().display(\"not-found\");\r\n    },\r\n\r\n    saveDraft() {\r\n        var oModel = this.getModel(\"view\"),\r\n            oData = {\r\n                data: this.getModel(\"data\").getData(),\r\n                time: new Date().getTime()\r\n            },\r\n            sHash = HashChanger.getInstance().getHash();\r\n        oModel.setProperty(\"/draft\", \"Saving\");\r\n        DraftService.save(sHash, oData).then(function(){\r\n            oModel.setProperty(\"/draft\", \"Saved\");\r\n        });\r\n    },\r\n\r\n    restoreDraft() {\r\n        var oViewModel = this.getModel(\"view\"),\r\n            oDataModel = this.getModel(\"data\"),\r\n            oBundle = this.getResourceBundle(),\r\n            fnOnConfirm = oData => {\r\n                oDataModel.setData(oData.data);\r\n                oViewModel.setProperty(\"/edit\", true);\r\n            },\r\n            fnOnDecline = () => {\r\n                oViewModel.setProperty(\"/edit\", true);\r\n                DraftService.remove(HashChanger.getInstance().getHash());\r\n            },\r\n            fnShowMsg = oData => {\r\n                var sMsg = oBundle.getText(\"txtEntityPageDraftExistsActionText\", [oDtFormat.format(new Date(oData.time))]);\r\n                MessageBox.show(sMsg, {\r\n                    icon: MessageBox.Icon.INFORMATION,\r\n                    title: oBundle.getText(\"txtEntityPageDraftExistsActionTitle\"),\r\n                    actions: [MessageBox.Action.YES, MessageBox.Action.NO],\r\n                    onClose: sAction => {\r\n                        if (sAction === MessageBox.Action.YES) {\r\n                            fnOnConfirm(oData);\r\n                        }\r\n                        else {\r\n                            fnOnDecline();\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n\r\n        DraftService.load(HashChanger.getInstance().getHash()).then(oData => {\r\n            if (oData && oData.data) {\r\n                var iDelay = this.getModel(\"user\").getProperty(\"/preference/draftResumeDelay\");\r\n                if ((new Date().getTime() - oData.time) <= iDelay * 60 * 1000) {\r\n                    fnOnConfirm(oData);\r\n                }\r\n                else {\r\n                    fnShowMsg(oData);\r\n                }\r\n            }\r\n            else {\r\n                fnOnDecline();\r\n            }\r\n        });\r\n    }\r\n\r\n});\r\n"]}