{"version":3,"sources":["Base.es6.js"],"names":["CONSTANTS","SCROLL_OFFSET","extend","_rendered","getEntityRoute","getCreateApiPath","onInit","buildViewModel","buildDataModel","Deferred","onAfterRendering","resolve","setModel","getInitialViewModelContent","getInitialDataModelContent","getWizard","byId","onValueChanged","prototype","apply","arguments","saveDraft","onRouteMatched","_reset","restoreDraft","onReset","remove","getInstance","getHash","onComplete","oData","getModel","getData","post","getRouter","navTo","id","sId","oModel","sHash","data","wizard","getProperty","setProperty","save","then","_updateWizardModel","load","setData","_updateWizardControl","oWizard","oFirstStep","getSteps","discardProgress","getProgress","iTargetStep","i","nextStep"],"mappings":"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","file":"Base.js","sourcesContent":["import Base from \"spet/sbwo/web/private/controller/Base\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\r\nimport DraftService from \"spet/sbwo/web/private/util/DraftService\";\r\nimport Wizard from \"sap/m/Wizard\";\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nif (Wizard.CONSTANTS) {\r\n    Wizard.CONSTANTS.SCROLL_OFFSET = 0;\r\n}\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.wizard.Base\", {\r\n    _rendered: null,\r\n\r\n    getEntityRoute() {},\r\n    getCreateApiPath() {},\r\n\r\n    onInit() {\r\n        this.buildViewModel();\r\n        this.buildDataModel();\r\n        this._rendered = jQuery.Deferred();\r\n    },\r\n\r\n    onAfterRendering() {\r\n        this._rendered.resolve();\r\n    },\r\n\r\n    buildViewModel() {\r\n        this.setModel(new JSONModel(this.getInitialViewModelContent()), \"view\");\r\n    },\r\n\r\n    buildDataModel() {\r\n        this.setModel(new JSONModel(this.getInitialDataModelContent()), \"data\");\r\n    },\r\n\r\n    getWizard() {\r\n        return this.byId(\"wizMain\");\r\n    },\r\n\r\n    getInitialDataModelContent() {\r\n        return {};\r\n    },\r\n\r\n    getInitialViewModelContent() {\r\n        return {};\r\n    },\r\n\r\n    onValueChanged() {\r\n        Base.prototype.onValueChanged.apply(this, arguments);\r\n        this.saveDraft();\r\n    },\r\n\r\n    onRouteMatched() {\r\n        this._reset();\r\n        this.restoreDraft();\r\n    },\r\n\r\n    onReset() {\r\n        this._reset();\r\n        DraftService.remove(HashChanger.getInstance().getHash());\r\n    },\r\n\r\n    onComplete() {\r\n        let oData = this.getModel(\"data\").getData();\r\n        this.post(this.getCreateApiPath(), oData, sId => {\r\n            DraftService.remove(HashChanger.getInstance().getHash());\r\n            this.getRouter().navTo(this.getEntityRoute(), {\r\n                id: sId\r\n            }, true);\r\n        });\r\n    },\r\n\r\n    saveDraft() {\r\n        let oModel = this.getModel(\"view\"),\r\n            sHash = HashChanger.getInstance().getHash();\r\n        let oData = {\r\n            data: this.getModel(\"data\").getData(),\r\n            wizard: this.getModel(\"view\").getProperty(\"/wizard\")\r\n        };\r\n        oModel.setProperty(\"/draft\", \"Saving\");\r\n        DraftService.save(sHash, oData).then(() => oModel.setProperty(\"/draft\", \"Saved\"));\r\n        this._updateWizardModel();\r\n    },\r\n\r\n    restoreDraft() {\r\n        DraftService.load(HashChanger.getInstance().getHash()).then(oData => {\r\n            if (oData && oData.data) {\r\n                this.getModel(\"data\").setData(oData.data);\r\n                this.getModel(\"view\").setProperty(\"/wizard\", oData.wizard);\r\n                this._updateWizardControl();\r\n            }\r\n        });\r\n    },\r\n\r\n    _reset() {\r\n        let oWizard = this.getWizard(),\r\n            oFirstStep = oWizard.getSteps()[0];\r\n        oWizard.discardProgress(oFirstStep);\r\n        this.getModel(\"view\").setData(this.getInitialViewModelContent());\r\n        this.getModel(\"data\").setData(this.getInitialDataModelContent());\r\n    },\r\n\r\n    _updateWizardModel() {\r\n        this.getModel(\"view\").setProperty(\"/wizard/step\", this.getWizard().getProgress());\r\n    },\r\n\r\n    _updateWizardControl() {\r\n        this._rendered.then(() => {\r\n            let oWizard = this.getWizard(),\r\n                iTargetStep = this.getModel(\"view\").getProperty(\"/wizard/step\");\r\n            oWizard.discardProgress(oWizard.getSteps()[0]);\r\n            for (var i = 1; i < iTargetStep; ++i) {\r\n                oWizard.nextStep();\r\n            }\r\n        });\r\n    }\r\n});\r\n"]}