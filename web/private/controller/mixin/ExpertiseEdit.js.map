{"version":3,"sources":["ExpertiseEdit.es6.js"],"names":["extend","onAddExpertiseFine","oEvent","onAddCollection","date","Date","getTime","sum","onDeleteExpertiseLastFine","onDeleteCollectionLastItem","getCaseNumberInput","getNextHearing","oData","sMax","hearings","oHearing","onLoadCase","sNumber","getModel","getProperty","setProperty","get","encodeURIComponent","onCaseLoaded","onCaseNotFound","matter","substring","oInput","setValueState","setValueStateText","getResourceBundle","getText","onCourtLoaded","oModel","Code","Id","Name","onCourtClear","id","name","code","onCaseNumberChanged","sOldCode","sNewCode","fnUpdateCourt","results","length","onValueChanged","read","filters","success","onOpenCourtValueHelp","open"],"mappings":"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","file":"ExpertiseEdit.js","sourcesContent":["import BaseEdit from \"./BaseEdit\";\r\nimport Filter from \"sap/ui/model/Filter\";\r\nimport vhManager from \"spet/sbwo/web/private/util/vhManager\";\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nexport default jQuery.extend({}, BaseEdit, {\r\n    onAddExpertiseFine(oEvent) {\r\n        this.onAddCollection(oEvent, \"fines\", {\r\n            date: new Date().getTime(),\r\n            sum: 0\r\n        });\r\n    },\r\n\r\n    onDeleteExpertiseLastFine(oEvent) {\r\n        this.onDeleteCollectionLastItem(oEvent, \"fines\");\r\n    },\r\n\r\n    getCaseNumberInput() {\r\n        // must be overriden by target controllers\r\n    },\r\n\r\n    getNextHearing(oData) {\r\n        let sMax = \"\";\r\n        if (oData && oData.hearings) {\r\n            for (let oHearing of oData.hearings) {\r\n                sMax = sMax > oHearing.date ? sMax : oHearing.date;\r\n            }\r\n        }\r\n        return sMax === \"\" ? null : sMax;\r\n    },\r\n\r\n    onLoadCase() {\r\n        let sNumber = this.getModel(\"data\").getProperty(\"/number\");\r\n        this.getModel(\"view\").setProperty(\"/case\", null);\r\n        if (sNumber) {\r\n            this.get(\"/private/api/rest/expertise/case?number=\" + encodeURIComponent(sNumber),\r\n                oData => oData ? this.onCaseLoaded(oData) : this.onCaseNotFound()\r\n            );\r\n        }\r\n    },\r\n\r\n    onCaseLoaded(oData) {\r\n        this.getModel(\"view\").setProperty(\"/case\", oData);\r\n        this.getModel(\"data\").setProperty(\"/nextHearing\", this.getNextHearing(oData));\r\n        if (oData.matter) {\r\n            this.getModel(\"data\").setProperty(\"/title\", oData.matter.substring(0, 100));\r\n        }\r\n    },\r\n\r\n    onCaseNotFound() {\r\n        var oInput = this.getCaseNumberInput();\r\n        if (oInput) {\r\n            oInput.setValueState(\"Warning\");\r\n            oInput.setValueStateText(this.getResourceBundle().getText(\"txtExpertiseUnableToFindCaseText\"));\r\n        }\r\n    },\r\n\r\n    onCourtLoaded(oData) {\r\n        var oModel = this.getModel(\"data\");\r\n        oModel.setProperty(\"/court/code\", oData.Code);\r\n        oModel.setProperty(\"/court/id\", oData.Id);\r\n        oModel.setProperty(\"/court/name\", oData.Name);\r\n    },\r\n\r\n    onCourtClear() {\r\n        this.getModel(\"data\").setProperty(\"/court\", {\r\n            id: null,\r\n            name: \"\",\r\n            code: \"\"\r\n        });\r\n    },\r\n\r\n    onCaseNumberChanged(oEvent) {\r\n        var oModel = this.getModel(\"data\"),\r\n            sOldCode = oModel.getProperty(\"/court/code\"),\r\n            sNewCode;\r\n\r\n        const fnUpdateCourt = oData => {\r\n            if (oData && oData.results && oData.results.length) {\r\n                this.onCourtLoaded(oData.results[0]);\r\n            } else {\r\n                this.onCourtClear();\r\n            }\r\n        };\r\n\r\n        this.onValueChanged(oEvent);\r\n        sNewCode = oModel.getProperty(\"/court/code\");\r\n\r\n        if (sOldCode !== sNewCode) {\r\n            if (sNewCode) {\r\n                this.getModel().read(\"/Courts\", {\r\n                    filters: [new Filter(\"Code\", \"EQ\", sNewCode)],\r\n                    success: fnUpdateCourt\r\n                });\r\n            } else {\r\n                this.onCourtClear();\r\n            }\r\n        }\r\n\r\n        this.onLoadCase();\r\n    },\r\n\r\n    onOpenCourtValueHelp() {\r\n        vhManager.get(\"Court\").open(this.onCourtLoaded, this);\r\n    }\r\n});\r\n"]}