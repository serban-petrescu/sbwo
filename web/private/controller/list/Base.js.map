{"version":3,"sources":["Base.es6.js"],"names":["extend","_groupHeaderFormatter","_filters","_query","getEntityRoute","getListRoute","getDefaultSortSettings","getCustomFilterForKey","getFormatterForColumn","onInit","getRouter","getRoute","attachPatternMatched","onRouteMatched","buildViewModel","settings","applied","getViewSettingsDialog","addStyleClass","getOwnerComponent","getContentDensityClass","byId","getList","getSearchField","getSearchAttribute","onSearch","oEvent","navTo","search","getParameter","sQuery","oField","getValue","setValue","_filterList","onPressItem","oContext","getSource","getBindingContext","id","getProperty","onResetViewSettings","aSorters","map","oSettings","path","descending","group","getModel","setData","getBinding","sort","onOpenViewSettingsDialog","open","onViewSettingsConfirm","fnApplySorting","oGroup","oSort","push","getKey","fnMapParent","mKeys","sParentKey","aFilters","Object","keys","sKey","fnBuildFilterFromArray","bAnd","length","filters","and","fnComputeFilters","oComposite","oFilter","oDefault","setProperty","buildGroupHeader","sTitle","key","title","getAllFilters","getSearchFilters","apply","oBinding","filter"],"mappings":"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","file":"Base.js","sourcesContent":["import Base from \"spet/sbwo/web/private/controller/Base\";\r\nimport Sorter from \"sap/ui/model/Sorter\";\r\nimport Filter from \"sap/ui/model/Filter\";\r\nimport GroupHeaderListItem from \"sap/m/GroupHeaderListItem\";\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.list.Base\", {\r\n    _groupHeaderFormatter: null,\r\n    _filters: [],\r\n    _query: \"\",\r\n\r\n    getEntityRoute(/*oContext*/){},\r\n\r\n    getListRoute(){},\r\n\r\n    getDefaultSortSettings() {\r\n        return [];\r\n    },\r\n\r\n    getCustomFilterForKey(/* sKey */) {\r\n        return null;\r\n    },\r\n\r\n    getFormatterForColumn(/* sColumn */) {\r\n        return null;\r\n    },\r\n\r\n    onInit() {\r\n        this.getRouter().getRoute(this.getListRoute()).attachPatternMatched(this.onRouteMatched, this);\r\n        this.buildViewModel({settings: {applied: false}});\r\n        if (this.getViewSettingsDialog()) {\r\n            this.getViewSettingsDialog().addStyleClass(this.getOwnerComponent().getContentDensityClass());\r\n        }\r\n    },\r\n\r\n    getViewSettingsDialog() {\r\n        return this.byId(\"vsdMain\");\r\n    },\r\n\r\n    getList() {\r\n        return this.byId(\"lstMain\");\r\n    },\r\n\r\n    getSearchField() {\r\n        return this.byId(\"seaMain\");\r\n    },\r\n\r\n    getSearchAttribute() {\r\n        return \"Search\";\r\n    },\r\n\r\n    onSearch(oEvent) {\r\n        this.getRouter().navTo(this.getListRoute(), {\r\n            search: oEvent.getParameter(\"query\")\r\n        }, true);\r\n    },\r\n\r\n    onRouteMatched(oEvent) {\r\n        var sQuery = oEvent.getParameter(\"arguments\").search || \"\",\r\n            oField = this.getSearchField();\r\n        if (oField.getValue() !== sQuery) {\r\n            oField.setValue(sQuery);\r\n        }\r\n        this._query = sQuery;\r\n        this._filterList();\r\n    },\r\n\r\n    onPressItem(oEvent) {\r\n        var oContext = oEvent.getSource().getBindingContext();\r\n        this.getRouter().navTo(this.getEntityRoute(oContext), {\r\n            id: oContext.getProperty(\"Id\")\r\n        });\r\n    },\r\n\r\n    onResetViewSettings() {\r\n        var aSorters = this.getDefaultSortSettings()\r\n            .map(oSettings => new Sorter(oSettings.path, oSettings.descending, oSettings.group));\r\n        this.getModel(\"view\").setData({settings: {applied: false}});\r\n        this.getList().getBinding(\"items\").sort(aSorters);\r\n        this._filters = [];\r\n        this._filterList();\r\n    },\r\n\r\n    onOpenViewSettingsDialog() {\r\n        this.getViewSettingsDialog().open();\r\n    },\r\n\r\n    onViewSettingsConfirm(oEvent) {\r\n        var fnApplySorting = () => {\r\n                var aSorters = [],\r\n                    oGroup = oEvent.getParameter(\"groupItem\"),\r\n                    oSort = oEvent.getParameter(\"sortItem\");\r\n                if (oGroup) {\r\n                    aSorters.push(new Sorter(oGroup.getKey(), oEvent.getParameter(\"groupDescending\"), true));\r\n                    this._groupHeaderFormatter = this.getFormatterForColumn(oGroup.getKey());\r\n                }\r\n                if (oSort) {\r\n                    aSorters.push(new Sorter(oSort.getKey(), oEvent.getParameter(\"sortDescending\"), false));\r\n                }\r\n                this.getList().getBinding(\"items\").sort(aSorters);\r\n            },\r\n\r\n            fnMapParent = (mKeys, sParentKey) => {\r\n                var aFilters = [];\r\n                for (let sKey of Object.keys(mKeys)) {\r\n                    if (mKeys[sKey]) {\r\n                        aFilters.push(new Filter(sParentKey, \"EQ\", sKey));\r\n                    }\r\n                }\r\n                return aFilters;\r\n            },\r\n\r\n            fnBuildFilterFromArray = (bAnd, aFilters) => {\r\n                if (aFilters.length === 0) {\r\n                    return null;\r\n                }\r\n                else if (aFilters.length === 1) {\r\n                    return aFilters[0];\r\n                }\r\n                else {\r\n                    return new Filter({filters: aFilters, and: bAnd});\r\n                }\r\n            },\r\n\r\n            fnComputeFilters = () => {\r\n                var oComposite = oEvent.getParameter(\"filterCompoundKeys\") || {},\r\n                    aFilters = [];\r\n\r\n                for (let sKey of Object.keys(oComposite)) {\r\n                    let oFilter = fnBuildFilterFromArray(false, fnMapParent(oComposite[sKey], sKey));\r\n                    if (oFilter) {\r\n                        aFilters.push(oFilter);\r\n                    }\r\n                }\r\n\r\n                let oDefault = oComposite[\"\"];\r\n                if (oDefault) {\r\n                    for (let sKey of oDefault) {\r\n                        let oFilter = this.getCustomFilterForKey(sKey);\r\n                        if (oFilter) {\r\n                            aFilters.push(oFilter);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return aFilters;\r\n            };\r\n\r\n        fnApplySorting();\r\n        this._filters = fnComputeFilters();\r\n        this._filterList();\r\n        this.getModel(\"view\").setProperty(\"/settings/applied\", true);\r\n    },\r\n\r\n    buildGroupHeader(oGroup) {\r\n        var sTitle = this._groupHeaderFormatter ? this._groupHeaderFormatter(oGroup.key) : oGroup.key;\r\n        return new GroupHeaderListItem({title: sTitle});\r\n    },\r\n\r\n    getAllFilters() {\r\n        var aFilters = this.getSearchFilters(this._query, this.getSearchAttribute());\r\n        aFilters.push.apply(aFilters, this._filters);\r\n        return aFilters;\r\n    },\r\n\r\n    _filterList() {\r\n        var aFilters = this.getAllFilters(),\r\n            oBinding = this.getList().getBinding(\"items\");\r\n        if (aFilters.length){\r\n            oBinding.filter(new Filter({\r\n                filters: aFilters,\r\n                and: true\r\n            }));\r\n        }\r\n        else {\r\n            oBinding.filter(aFilters);\r\n        }\r\n    }\r\n\r\n});\r\n"]}