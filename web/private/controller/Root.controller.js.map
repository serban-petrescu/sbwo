{"version":3,"sources":["Root.controller.es6.js"],"names":["extend","onInit","sClass","getOwnerComponent","getContentDensityClass","oOverlay","initialize","getView","sap","delayedCall","fadeOut","remove","bind","buildViewModel","menu","edit","favourites","isFavourite","hash","getInstance","getHash","help","addStyleClass","byId","getDependents","forEach","oControl","attachHashAndRoutes","fnHelp","getModel","setProperty","route","getResourceBundle","sRoute","fnBuildHandler","oEvent","getParameter","sParameter","updateFavoriteModel","attachEvent","getRouter","attachRouteMatched","attachBypassed","onCloseHelpDialog","close","onOpenHelpDialog","open","onLogoff","window","location","assign","onShowFavourites","oModel","bOpen","getProperty","get","onToggleEdit","getSource","getPressed","oData","put","aFavData","sHash","aFavs","undefined","sort","a","b","title","toUpperCase","localeCompare","find","oFav","onToggleFavourite","fnCreate","document","post","oDt","push","fnDelete","iIndex","findIndex","del","id","splice","onDeleteFavouriteEdit","oItem","sPath","getBindingContext","getPath","parseInt","substring","lastIndexOf","onCloseFavourites","onNavigateToFavourite","setHash","onPressHome","navTo","onPressPersonalization","onOpenGlobalSearch","onSearchField","oPopover","oSearch","oBinding","getBinding","applySearchFilter","setContentWidth","$","width","attachEventOnce","openBy","onSearchDialog","onSelectSearchDialog","oContext","navigateToEntity","onSelectSearchPopover"],"mappings":"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","file":"Root.controller.js","sourcesContent":["import Base from \"./Base\";\r\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\r\nimport helps from \"spet/sbwo/web/private/model/helps\";\r\nimport vhManager from \"spet/sbwo/web/private/util/vhManager\";\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.Root\", {\r\n    onInit() {\r\n        let sClass = this.getOwnerComponent().getContentDensityClass(),\r\n            oOverlay = jQuery(\"#overlay\");\r\n\r\n        vhManager.initialize(this.getOwnerComponent(), this.getView());\r\n        jQuery.sap.delayedCall(1000, null, () => oOverlay.fadeOut(1000, oOverlay.remove.bind(oOverlay)));\r\n\r\n        this.buildViewModel({\r\n            menu: false,\r\n            edit: false,\r\n            favourites: [],\r\n            isFavourite: false,\r\n            hash: HashChanger.getInstance().getHash(),\r\n            help: null\r\n        });\r\n\r\n        this.getView().addStyleClass(sClass);\r\n        this.byId(\"shlMain\").getDependents().forEach(oControl => oControl.addStyleClass(sClass));\r\n        this.attachHashAndRoutes();\r\n    },\r\n\r\n    attachHashAndRoutes() {\r\n        const fnHelp = sRoute => this.getModel(\"view\").setProperty(\"/help\", helps.route(this.getResourceBundle(), sRoute));\r\n\r\n        const fnBuildHandler = sParameter => {\r\n            return oEvent => {\r\n                this.getModel(\"view\").setProperty(\"/hash\", oEvent.getParameter(sParameter));\r\n                this.updateFavoriteModel();\r\n            };\r\n        };\r\n\r\n        HashChanger.getInstance()\r\n            .attachEvent(\"hashChanged\", fnBuildHandler(\"newHash\"))\r\n            .attachEvent(\"hashReplaced\", fnBuildHandler(\"sHash\"))\r\n            .attachEvent(\"hashSet\", fnBuildHandler(\"sHash\"));\r\n\r\n        this.getRouter()\r\n            .attachRouteMatched(oEvent => fnHelp(oEvent.getParameter(\"name\")))\r\n            .attachBypassed(() => fnHelp(\"home\"));\r\n    },\r\n\r\n    onCloseHelpDialog() {\r\n        this.byId(\"dlgHelpVideo\").close();\r\n    },\r\n\r\n    onOpenHelpDialog() {\r\n        this.byId(\"dlgHelpVideo\").open();\r\n    },\r\n\r\n    onLogoff() {\r\n        window.location.assign(\"/public/rest/user/logout\");\r\n    },\r\n\r\n    onShowFavourites() {\r\n        let oModel = this.getModel(\"view\"),\r\n            bOpen;\r\n\r\n        if (this.getModel(\"device\").getProperty(\"/system/phone\")) {\r\n            oModel.setProperty(\"/menu\", true);\r\n            this.byId(\"dlgFavourites\").open();\r\n            bOpen = true;\r\n        } else {\r\n            bOpen = !oModel.getProperty(\"/menu\");\r\n            oModel.setProperty(\"/menu\", bOpen);\r\n        }\r\n\r\n        if (bOpen) {\r\n            this.get(\"/private/api/rest/user/favourites/read\", this.updateFavoriteModel);\r\n        }\r\n    },\r\n\r\n    onToggleEdit(oEvent) {\r\n        if (!oEvent.getSource().getPressed()) {\r\n            let oData = this.getModel(\"view\").getProperty(\"/favourites\");\r\n            this.put(\"/private/api/rest/user/favourites/update\", oData, this.updateFavoriteModel);\r\n        }\r\n    },\r\n\r\n    updateFavoriteModel(aFavData) {\r\n        let oModel = this.getModel(\"view\"),\r\n            sHash = oModel.getProperty(\"/hash\"),\r\n            aFavs = aFavData === undefined ? oModel.getProperty(\"/favourites\") : aFavData;\r\n\r\n        aFavs.sort((a, b) => a.title.toUpperCase().localeCompare(b.title.toUpperCase()));\r\n\r\n        oModel.setProperty(\"/favourites\", aFavs);\r\n        oModel.setProperty(\"/isFavourite\", !!aFavs.find(oFav => oFav.hash === sHash));\r\n    },\r\n\r\n    onToggleFavourite(oEvent) {\r\n        var oModel = this.getModel(\"view\"),\r\n            aFavs = oModel.getProperty(\"/favourites\"),\r\n            sHash = oModel.getProperty(\"/hash\");\r\n\r\n        const fnCreate = () => {\r\n            let oData = {\r\n                hash: sHash,\r\n                title: window.document.title\r\n            };\r\n            this.post(\"/private/api/rest/user/favourites/create\", oData, (oDt) => {\r\n                aFavs.push(oDt);\r\n                this.updateFavoriteModel(aFavs);\r\n            });\r\n        };\r\n\r\n        const fnDelete = () => {\r\n            let iIndex = aFavs.findIndex(oFav => oFav.hash === sHash);\r\n            if (iIndex !== undefined) {\r\n                this.del(\"/private/api/rest/user/favourites/delete/\" + aFavs[iIndex].id, () => {\r\n                    aFavs.splice(iIndex, 1);\r\n                    this.updateFavoriteModel(aFavs);\r\n                });\r\n            }\r\n        };\r\n\r\n        oEvent.getSource().getPressed() ? fnCreate() : fnDelete();\r\n    },\r\n\r\n    onDeleteFavouriteEdit(oEvent) {\r\n        let oItem = oEvent.getParameter(\"listItem\"),\r\n            sPath = oItem.getBindingContext(\"view\").getPath(),\r\n            iIndex = parseInt(sPath.substring(sPath.lastIndexOf(\"/\") + 1), 10),\r\n            aFavs = this.getModel(\"view\").getProperty(\"/favourites\");\r\n        aFavs.splice(iIndex, 1);\r\n        this.updateFavoriteModel(aFavs);\r\n    },\r\n\r\n    onCloseFavourites() {\r\n        this.getModel(\"view\").setProperty(\"/menu\", false);\r\n        this.byId(\"dlgFavourites\").close();\r\n    },\r\n\r\n    onNavigateToFavourite(oEvent) {\r\n        let sHash = oEvent.getSource().getBindingContext(\"view\").getProperty(\"hash\");\r\n        HashChanger.getInstance().setHash(sHash);\r\n    },\r\n\r\n    onPressHome() {\r\n        this.getRouter().navTo(\"home\", {});\r\n    },\r\n\r\n    onPressPersonalization() {\r\n        this.getRouter().navTo(\"user-settings\", {});\r\n    },\r\n\r\n    onOpenGlobalSearch() {\r\n        this.byId(\"sedGlobalSearch\").open(\"\");\r\n    },\r\n\r\n    onSearchField(oEvent) {\r\n        let oPopover = this.byId(\"popGlobalSearch\"),\r\n            oSearch = oEvent.getSource(),\r\n            oBinding = this.byId(\"lstSearchPopover\").getBinding(\"items\");\r\n        this.applySearchFilter(oEvent.getParameter(\"query\"), \"Search\", oBinding);\r\n        oPopover.setContentWidth(oSearch.$().width() + \"px\");\r\n        oBinding.attachEventOnce(\"dataReceived\", () => oPopover.openBy(oSearch));\r\n    },\r\n\r\n    onSearchDialog(oEvent) {\r\n        this.applySearchFilter(oEvent.getParameter(\"value\"), \"Search\", oEvent.getParameter(\"itemsBinding\"));\r\n    },\r\n\r\n    onSelectSearchDialog(oEvent) {\r\n        let oContext = oEvent.getParameter(\"selectedItem\").getBindingContext();\r\n        this.navigateToEntity(oContext.getProperty(\"Type\"), oContext.getProperty(\"Id\"));\r\n    },\r\n\r\n    onSelectSearchPopover(oEvent) {\r\n        let oContext = oEvent.getSource().getBindingContext();\r\n        this.navigateToEntity(oContext.getProperty(\"Type\"), oContext.getProperty(\"Id\"));\r\n        this.byId(\"popGlobalSearch\").close();\r\n    }\r\n});\r\n"]}