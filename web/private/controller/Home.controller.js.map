{"version":3,"sources":["Home.controller.es6.js"],"names":["extend","onInit","buildViewModel","edit","tiles","counts","readTiles","getRouter","getTargets","getTarget","attachDisplay","readCounts","getDefaultTiles","getResourceBundle","buildTile","sId","oContext","sNumberPath","getProperty","title","icon","type","press","onPressTile","bind","visible","path","model","number","formatOptions","style","numberUnit","onTileDelete","oEvent","sPath","getParameter","getBindingContext","getPath","getModel","setProperty","onTileMove","aTiles","getSource","getTiles","oModel","i","length","onEditButtonPressed","oResult","oTiles","Object","keys","sKey","order","put","onTilesRead","resetTiles","get","oCounts","oData","oContainer","byId","getBinding","sort","navTo","apply"],"mappings":"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","file":"Home.controller.js","sourcesContent":["import Base from \"./Base\";\r\nimport StandardTile from \"sap/m/StandardTile\";\r\nimport Sorter from \"sap/ui/model/Sorter\";\r\nimport tiles from \"spet/sbwo/web/private/model/tiles\";\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.Home\", {\r\n    onInit() {\r\n        this.buildViewModel({\r\n            edit: false,\r\n            tiles: {},\r\n            counts: {}\r\n        });\r\n        this.readTiles();\r\n        this.getRouter().getTargets().getTarget(\"home\").attachDisplay(this.readCounts, this);\r\n    },\r\n\r\n    getDefaultTiles() {\r\n        return tiles(this.getResourceBundle());\r\n    },\r\n\r\n    buildTile(sId, oContext) {\r\n        let sNumberPath = null;\r\n        if (oContext.getProperty(\"count\")) {\r\n            sNumberPath = \"/counts/\" + oContext.getProperty(\"count\");\r\n        }\r\n        else if (oContext.getProperty(\"number\")) {\r\n            sNumberPath = \"number\";\r\n        }\r\n\r\n        if (sNumberPath) {\r\n            return new StandardTile(sId, {\r\n                title:\toContext.getProperty(\"title\"),\r\n                icon:\toContext.getProperty(\"icon\"),\r\n                type:\toContext.getProperty(\"type\"),\r\n                press:\tthis.onPressTile.bind(this),\r\n                visible: {\r\n                    path: \"visible\",\r\n                    model: \"view\"\r\n                },\r\n                number: {\r\n                    path: sNumberPath,\r\n                    model: \"view\",\r\n                    type: \"sap.ui.model.type.Integer\",\r\n                    formatOptions: {style: \"short\"}\r\n                },\r\n                numberUnit: oContext.getProperty(\"unit\")\r\n            });\r\n        }\r\n        else {\r\n            return new StandardTile(sId, {\r\n                title:\toContext.getProperty(\"title\"),\r\n                icon:\toContext.getProperty(\"icon\"),\r\n                type:\toContext.getProperty(\"type\"),\r\n                press:\tthis.onPressTile.bind(this),\r\n                visible: {\r\n                    path: \"visible\",\r\n                    model: \"view\"\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    onTileDelete(oEvent) {\r\n        let sPath = oEvent.getParameter(\"tile\").getBindingContext(\"view\").getPath() + \"/visible\";\r\n        this.getModel(\"view\").setProperty(sPath, false);\r\n    },\r\n\r\n    onTileMove(oEvent) {\r\n        var aTiles = oEvent.getSource().getTiles(),\r\n            oModel = this.getModel(\"view\");\r\n        for (let i = 0; i < aTiles.length; ++i) {\r\n            oModel.setProperty(aTiles[i].getBindingContext(\"view\").getPath() + \"/order\", i);\r\n        }\r\n    },\r\n\r\n    onEditButtonPressed() {\r\n        let oModel = this.getModel(\"view\"),\r\n            oResult = {};\r\n        if (!oModel.getProperty(\"/edit\")) {\r\n            let oTiles = oModel.getProperty(\"/tiles\") || {};\r\n            for (let sKey of Object.keys(oTiles)) {\r\n                oResult[sKey] = {\r\n                    visible: oTiles[sKey].visible,\r\n                    order: oTiles[sKey].order\r\n                };\r\n            }\r\n            this.put(\"/private/api/rest/user/tiles/update\", {tiles: oResult}, this.onTilesRead);\r\n        }\r\n    },\r\n\r\n    resetTiles() {\r\n        this.getModel(\"view\").setProperty(\"/tiles\", this.getDefaultTiles());\r\n    },\r\n\r\n    readTiles() {\r\n        this.get(\"/private/api/rest/user/tiles/read\", this.onTilesRead);\r\n    },\r\n\r\n    readCounts() {\r\n        this.get(\"/private/api/rest/utility/count\", oCounts => this.getModel(\"view\").setProperty(\"/counts\", oCounts));\r\n    },\r\n\r\n    onTilesRead(oData) {\r\n        let oModel = this.getModel(\"view\"),\r\n            oContainer = this.byId(\"tlcHome\");\r\n        if (oData && oData.tiles) {\r\n            oModel.setProperty(\"/tiles\", jQuery.extend(true, this.getDefaultTiles(), oData.tiles));\r\n            oContainer.getBinding(\"tiles\").sort(new Sorter({path: \"order\"}));\r\n        }\r\n    },\r\n\r\n    onPressTile(oEvent) {\r\n        var oContext = oEvent.getSource().getBindingContext(\"view\");\r\n        this.getRouter().navTo.apply(this.getRouter(), oContext.getProperty(\"navinfo\"));\r\n    }\r\n});\r\n"]}