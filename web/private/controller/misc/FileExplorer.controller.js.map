{"version":3,"sources":["FileExplorer.controller.es6.js"],"names":["sBaseApiPath","oSystem","separator","roots","fnIsRoot","sDir","i","length","name","ajax","url","method","success","oData","map","sRoot","icon","fnGetIconForExtension","sExt","toLowerCase","extend","onInit","buildViewModel","current","extension","folder","files","folders","multiselect","byId","addStyleClass","getOwnerComponent","getContentDensityClass","bMulti","getModel","setProperty","sCurrent","file","onFolderPress","oEvent","sName","getSource","getBindingContext","getProperty","lastIndexOf","read","onUpPress","substring","onOkPress","oModel","sBase","oList","aSels","getSelectedItems","oSel","fireEvent","result","close","open","readFolders","readFiles","data","base","content","sFolder","error","oFile"],"mappings":"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","file":"FileExplorer.controller.js","sourcesContent":["import Base from \"spet/sbwo/web/private/controller/Base\";\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nvar sBaseApiPath = \"/private/api/rest/utility/file/explore\";\r\n\r\nvar oSystem = {\r\n    separator: \"/\",\r\n    roots: []\r\n};\r\n\r\nvar fnIsRoot = function (sDir) {\r\n    for (var i = 0; i < oSystem.roots.length; ++i) {\r\n        if (oSystem.roots[i].name === sDir || oSystem.roots[i].name + oSystem.separator === sDir) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\n\r\njQuery.ajax({\r\n    url: sBaseApiPath + \"/roots\",\r\n    method: \"GET\",\r\n    success: oData => {\r\n        oSystem.separator = oData.separator;\r\n        oSystem.roots = oData.roots.map(function (sRoot) {\r\n            return {\r\n                name: sRoot,\r\n                icon: \"sap-icon://folder-full\"\r\n            };\r\n        });\r\n    }\r\n});\r\n\r\nvar fnGetIconForExtension = function (sExt) {\r\n    switch (sExt.toLowerCase()) {\r\n        case \"mp3\":\r\n        case \"wav\":\r\n        case \"flac\":\r\n            return \"sap-icon://attachment-audio\";\r\n        case \"html\":\r\n        case \"htm\":\r\n        case \"xml\":\r\n            return \"sap-icon://attachment-html\";\r\n        case \"png\":\r\n        case \"svg\":\r\n        case \"jpg\":\r\n        case \"bmp\":\r\n        case \"gif\":\r\n            return \"sap-icon://attachment-photo\";\r\n        case \"txt\":\r\n        case \"ini\":\r\n        case \"rtf\":\r\n            return \"sap-icon://attachment-text-file\";\r\n        case \"avi\":\r\n        case \"mkv\":\r\n        case \"mp4\":\r\n        case \"mpeg\":\r\n            return \"sap-icon://attachment-video\";\r\n        case \"zip\":\r\n        case \"gz\":\r\n        case \"7z\":\r\n        case \"rar\":\r\n            return \"sap-icon://attachment-zip-file\";\r\n        case \"doc\":\r\n        case \"docx\":\r\n            return \"sap-icon://doc-attachment\";\r\n        case \"xls\":\r\n        case \"xlsx\":\r\n        case \"csv\":\r\n            return \"sap-icon://excel-attachment\";\r\n        case \"pdf\":\r\n            return \"sap-icon://pdf-attachment\";\r\n        default:\r\n            return \"sap-icon://document\";\r\n    }\r\n};\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.misc.FileExplorer\", {\r\n    onInit() {\r\n        this.buildViewModel({\r\n            current: \"\",\r\n            extension: \"\",\r\n            folder: true,\r\n            files: [],\r\n            folders: [],\r\n            multiselect: false\r\n        });\r\n\r\n        this.byId(\"dlgMain\").addStyleClass(this.getOwnerComponent().getContentDensityClass());\r\n    },\r\n\r\n    multiselect(bMulti) {\r\n        this.getModel(\"view\").setProperty(\"/multiselect\", bMulti);\r\n        return this;\r\n    },\r\n\r\n    current(sCurrent) {\r\n        this.getModel(\"view\").setProperty(\"/current\", sCurrent);\r\n        return this;\r\n    },\r\n\r\n    folder() {\r\n        this.getModel(\"view\").setProperty(\"/folder\", true);\r\n        return this;\r\n    },\r\n\r\n    file(sExt) {\r\n        this.getModel(\"view\").setProperty(\"/folder\", false);\r\n        this.getModel(\"view\").setProperty(\"/extension\", sExt);\r\n        return this;\r\n    },\r\n\r\n    onFolderPress(oEvent) {\r\n        var sName = oEvent.getSource().getBindingContext(\"view\").getProperty(\"name\"),\r\n            sCurrent = this.getModel(\"view\").getProperty(\"/current\");\r\n        if (sCurrent.lastIndexOf(oSystem.separator) === sCurrent.length - 1) {\r\n            sCurrent += sName + oSystem.separator;\r\n        } else {\r\n            sCurrent += oSystem.separator + sName + oSystem.separator;\r\n        }\r\n        this.getModel(\"view\").setProperty(\"/current\", sCurrent);\r\n        this.read();\r\n    },\r\n\r\n    onUpPress() {\r\n        var sCurrent = this.getModel(\"view\").getProperty(\"/current\");\r\n        if (fnIsRoot(sCurrent) || !sCurrent) {\r\n            this.getModel(\"view\").setProperty(\"/current\", \"\");\r\n            this.getModel(\"view\").setProperty(\"/folders\", oSystem.roots);\r\n        } else {\r\n            sCurrent = sCurrent.substring(0, sCurrent.lastIndexOf(oSystem.separator, sCurrent.length - 1) + 1) || oSystem.separator;\r\n            this.getModel(\"view\").setProperty(\"/current\", sCurrent);\r\n            this.read();\r\n        }\r\n    },\r\n\r\n    onOkPress() {\r\n        var oModel = this.getModel(\"view\"),\r\n            sBase = this.getModel(\"view\").getProperty(\"/current\"),\r\n            oList = oModel.getProperty(\"/folder\") ? this.byId(\"lstFolders\") : this.byId(\"lstFiles\"),\r\n            aSels = oList.getSelectedItems().map(oSel => {\r\n                if (sBase.lastIndexOf(oSystem.separator) === sBase.length - 1) {\r\n                    return sBase + oSel.getBindingContext(\"view\").getProperty(\"name\");\r\n                } else {\r\n                    return sBase + oSystem.separator + oSel.getBindingContext(\"view\").getProperty(\"name\");\r\n                }\r\n            });\r\n        if (oModel.getProperty(\"/folder\") && !oModel.getProperty(\"/multiselect\")) {\r\n            this.fireEvent(\"select\", {\r\n                result: [sBase]\r\n            });\r\n        } else {\r\n            this.fireEvent(\"select\", {\r\n                result: aSels\r\n            });\r\n        }\r\n        this.close();\r\n    },\r\n\r\n    open() {\r\n        this.byId(\"dlgMain\").open();\r\n        this.read();\r\n    },\r\n\r\n    close() {\r\n        this.byId(\"dlgMain\").close();\r\n    },\r\n\r\n    read() {\r\n        var oModel = this.getModel(\"view\");\r\n        this.readFolders(oModel);\r\n        if (!oModel.getProperty(\"folder\")) {\r\n            this.readFiles(oModel);\r\n        }\r\n    },\r\n\r\n    readFolders(oModel) {\r\n        jQuery.ajax({\r\n            method: \"GET\",\r\n            url: sBaseApiPath + \"/folders\",\r\n            data: {\r\n                base: oModel.getProperty(\"/current\")\r\n            },\r\n            success: oData => {\r\n                oModel.setProperty(\"/current\", oData.base);\r\n                oModel.setProperty(\"/folders\", oData.content.map(sFolder => {\r\n                    return {\r\n                        name: sFolder,\r\n                        icon: \"sap-icon://open-folder\"\r\n                    };\r\n                }));\r\n            },\r\n            error: () => oModel.setProperty(\"/folders\", [])\r\n        });\r\n    },\r\n\r\n    readFiles(oModel) {\r\n        jQuery.ajax({\r\n            method: \"GET\",\r\n            url: sBaseApiPath + \"/files\",\r\n            data: {\r\n                base: oModel.getProperty(\"/current\"),\r\n                extension: oModel.getProperty(\"/extension\")\r\n            },\r\n            success: oData => {\r\n                oModel.setProperty(\"/filder\", oData.content.map(oFile => {\r\n                    return {\r\n                        name: oFile.name + \".\" + oFile.extension,\r\n                        icon: fnGetIconForExtension(oFile.extension)\r\n                    };\r\n                }));\r\n            },\r\n            error: () => oModel.setProperty(\"/files\", [])\r\n        });\r\n    }\r\n\r\n});\r\n"]}