{"version":3,"sources":["Import.controller.es6.js"],"names":["fnInitializeData","oData","fnOnEachFile","iIndex","oFile","exists","size","fnOnEachImport","sKey","oImport","each","files","ready","oPromise","oDeferred","Deferred","ajax","method","url","sap","getModulePath","then","resolve","fail","reject","promise","extend","onInit","buildViewModel","busy","selected","data","reset","oModel","getModel","setProperty","getOwnerComponent","securityTokenAvailable","sToken","getView","bindElement","model","path","byId","clear","formatTabText","sText","getResourceBundle","getText","camelCase","formatFileDescription","sFile","formatTabDescription","formatUploadUrl","sName","formatZipPath","onUpdateBinding","getProperty","onUploadChange","oEvent","aFiles","getParameter","oImports","fnGetFileName","lastIndexOf","substring","fnUpdateFile","iSize","j","length","name","fnUpdateReadyFlag","optional","i","bind","refresh","onStartUpload","upload","onUploadComplete","oBundle","success","onInternalServerError"],"mappings":"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","file":"Import.controller.js","sourcesContent":["import Base from \"spet/sbwo/web/private/controller/Base\";\r\nimport MessageBox from \"sap/m/MessageBox\";\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nvar fnInitializeData = function (oData) {\r\n    var fnOnEachFile = function (iIndex, oFile) {\r\n            oFile.exists = false;\r\n            oFile.size = null;\r\n        },\r\n        fnOnEachImport = function (sKey, oImport) {\r\n            jQuery.each(oImport.files, fnOnEachFile);\r\n            oImport.ready = false;\r\n        };\r\n    jQuery.each(oData, fnOnEachImport);\r\n};\r\n\r\nvar oPromise = (function () {\r\n    var oDeferred = jQuery.Deferred();\r\n    jQuery.ajax({\r\n        method: \"GET\",\r\n        url: jQuery.sap.getModulePath(\"spet.sbwo.web.private.model.import\", \"/data.json\")\r\n    }).then(function (oData) {\r\n        fnInitializeData(oData);\r\n        oDeferred.resolve(oData);\r\n    }).fail(function () {\r\n        oDeferred.reject();\r\n    });\r\n    return oDeferred.promise();\r\n}());\r\n\r\n\r\nexport default Base.extend(\"spet.sbwo.web.private.controller.misc.Import\", {\r\n    onInit() {\r\n        this.buildViewModel({\r\n            busy: false,\r\n            selected: \"persons\",\r\n            data: {}\r\n        });\r\n        this.reset();\r\n    },\r\n\r\n    reset() {\r\n        var oModel = this.getModel(\"view\");\r\n\r\n        oPromise.then(function (oData) {\r\n            oModel.setProperty(\"/data\", jQuery.extend(true, {}, oData));\r\n        });\r\n        this.getOwnerComponent().getModel().securityTokenAvailable().then(function (sToken) {\r\n            oModel.setProperty(\"/securityToken\", sToken);\r\n        });\r\n\r\n        oModel.setProperty(\"/selected\", \"persons\");\r\n        this.getView().bindElement({\r\n            model: \"view\",\r\n            path: \"/data/persons\"\r\n        });\r\n        this.byId(\"fupImport\").clear();\r\n    },\r\n\r\n    formatTabText(sText) {\r\n        return this.getResourceBundle().getText(jQuery.sap.camelCase(\"itf-import-\" + sText + \"-tab-text\"));\r\n    },\r\n\r\n    formatFileDescription(sFile) {\r\n        return this.getResourceBundle().getText(jQuery.sap.camelCase(\"txt-import-file-\" + sFile + \"-description\"));\r\n    },\r\n\r\n    formatTabDescription(sText) {\r\n        return this.getResourceBundle().getText(jQuery.sap.camelCase(\"itf-import-\" + sText + \"-tab-description\"));\r\n    },\r\n\r\n    formatUploadUrl(sName) {\r\n        return \"/private/api/rest/import/data/\" + sName;\r\n    },\r\n\r\n    formatZipPath(sName) {\r\n        return jQuery.sap.getModulePath(\"spet/sbwo/web/private/model/import\", \"/\" + sName + \".zip\");\r\n    },\r\n\r\n    onUpdateBinding() {\r\n        this.getView().bindElement({\r\n            model: \"view\",\r\n            path: \"/data/\" + this.getModel(\"view\").getProperty(\"/selected\")\r\n        });\r\n    },\r\n\r\n    onUploadChange(oEvent) {\r\n        var aFiles = oEvent.getParameter(\"files\"),\r\n            oModel = this.getModel(\"view\"),\r\n            oImports = oModel.getProperty(\"/data\"),\r\n            fnGetFileName = sName => sName.lastIndexOf(\".\") >= 0 ? sName.substring(0, sName.lastIndexOf(\".\")) : sName,\r\n            fnUpdateFile = function (sName, iSize, sKey, oImport) {\r\n                for (var j = 0; j < oImport.files.length; ++j) {\r\n                    if (oImport.files[j].name === sName) {\r\n                        oImport.files[j].exists = true;\r\n                        oImport.files[j].size = iSize;\r\n                    }\r\n                }\r\n            },\r\n            fnUpdateReadyFlag = function (sKey, oImport) {\r\n                oImport.ready = false;\r\n                for (var j = 0; j < oImport.files.length; ++j) {\r\n                    if (!oImport.files[j].exists && !oImport.files[j].optional) {\r\n                        return;\r\n                    }\r\n                }\r\n                oImport.ready = true;\r\n            };\r\n        fnInitializeData(oImports);\r\n        if (aFiles) {\r\n            for (let i = 0; i < aFiles.length; ++i) {\r\n                jQuery.each(oImports, fnUpdateFile.bind(null, fnGetFileName(aFiles[i].name || \"\"), aFiles[i].size));\r\n            }\r\n            jQuery.each(oImports, fnUpdateReadyFlag);\r\n        }\r\n        oModel.refresh();\r\n    },\r\n\r\n    onStartUpload() {\r\n        this.getModel(\"view\").setProperty(\"/busy\", true);\r\n        this.byId(\"fupImport\").upload();\r\n    },\r\n\r\n    onUploadComplete(oEvent) {\r\n        var oBundle = this.getResourceBundle();\r\n        this.getModel(\"view\").setProperty(\"/busy\", false);\r\n        if (oEvent.getParameter(\"status\") === 204) {\r\n            MessageBox.success(oBundle.getText(\"txtDataImportUploadSuccessText\"));\r\n            this.reset();\r\n        } else {\r\n            this.onInternalServerError(oEvent.getParameter(\"responseRaw\"));\r\n        }\r\n        this.getModel().refresh();\r\n    }\r\n\r\n});\r\n"]}