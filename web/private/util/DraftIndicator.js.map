{"version":3,"sources":["DraftIndicator.es6.js"],"names":["oBundle","getCore","getLibraryResourceBundle","sSaving","getText","sSaved","fnStateToText","sState","extend","metadata","properties","delay","type","defaultValue","state","aggregations","multiple","visibility","_queued","_ts","_oldState","init","setAggregation","Date","getTime","setState","iTs","iDelay","getDelay","setProperty","_updateLabel","sap","delayedCall","getState","oLabel","getAggregation","setText","renderer","oRm","oControl","write","writeControlData","addClass","writeClasses","renderControl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAKA,QAAMA,UAAU,iBAAMC,OAAN,GAAgBC,wBAAhB,CAAyC,OAAzC,CAAhB;AAAA,QACIC,UAAUH,QAAQI,OAAR,CAAgB,8BAAhB,CADd;AAAA,QAEIC,SAASL,QAAQI,OAAR,CAAgB,6BAAhB,CAFb;;AAIA,QAAME,gBAAgB,SAAhBA,aAAgB,SAAU;AAC5B,gBAAQC,MAAR;AACI,iBAAK,OAAL;AACI,uBAAOF,MAAP;AACJ,iBAAK,QAAL;AACI,uBAAOF,OAAP;AACJ;AACI,uBAAO,EAAP;AANR;AAQH,KATD;;sBAWe,kBAAQK,MAAR,CAAe,2CAAf,EAA4D;AACvEC,kBAAU;AACNC,wBAAY;AACRC,uBAAO;AACHC,0BAAM,KADH;AAEHC,kCAAc;AAFX,iBADC;AAKRC,uBAAO;AACHF,0BAAM,2BADH;AAEHC,kCAAc;AAFX;AALC,aADN;AAWNE,0BAAc;AACV,0BAAU;AACNH,0BAAM,aADA;AAENI,8BAAU,KAFJ;AAGNC,gCAAY;AAHN;AADA;AAXR,SAD6D;;AAqBvEC,iBAAS,KArB8D;AAsBvEC,aAAK,CAtBkE;AAuBvEC,mBAAW,EAvB4D;;AAyBvEC,YAzBuE,kBAyBhE;AACH,iBAAKC,cAAL,CAAoB,QAApB,EAA8B,qBAA9B;AACA,iBAAKH,GAAL,GAAW,IAAII,IAAJ,GAAWC,OAAX,EAAX;AACH,SA5BsE;AA8BvEC,gBA9BuE,oBA8B9DlB,MA9B8D,EA8BtD;AACb,gBAAImB,MAAM,IAAIH,IAAJ,GAAWC,OAAX,EAAV;AAAA,gBACIG,SAAS,KAAKC,QAAL,EADb;AAEA,iBAAKC,WAAL,CAAiB,OAAjB,EAA0BtB,MAA1B;AACA,gBAAI,CAAC,KAAKW,OAAV,EAAmB;AACf,oBAAIQ,MAAM,KAAKP,GAAX,GAAiBQ,MAArB,EAA6B;AACzB,yBAAKG,YAAL;AACH,iBAFD,MAEO;AACH,yBAAKZ,OAAL,GAAe,IAAf;AACA,wCAAOa,GAAP,CAAWC,WAAX,CAAuBL,UAAUD,MAAM,KAAKP,GAArB,CAAvB,EAAkD,IAAlD,EAAwD,KAAKW,YAA7D;AACH;AACJ;AACJ,SA1CsE;AA4CvEA,oBA5CuE,0BA4CxD;AACX,gBAAIvB,SAAS,KAAK0B,QAAL,EAAb;AAAA,gBACIC,SAAS,KAAKC,cAAL,CAAoB,QAApB,CADb;AAEA,iBAAKjB,OAAL,GAAe,KAAf;AACA,gBAAI,KAAKE,SAAL,KAAmBb,MAAvB,EAA+B;AAC3B,qBAAKY,GAAL,GAAW,IAAII,IAAJ,GAAWC,OAAX,EAAX;AACH;AACD,iBAAKJ,SAAL,GAAiBb,MAAjB;AACA2B,mBAAOE,OAAP,CAAe9B,cAAcC,MAAd,CAAf;AACH,SArDsE;AAuDvE8B,gBAvDuE,oBAuD9DC,GAvD8D,EAuDzDC,QAvDyD,EAuD/C;AACpBD,gBAAIE,KAAJ,CAAU,MAAV;AACAF,gBAAIG,gBAAJ,CAAqBF,QAArB;AACAD,gBAAII,QAAJ,CAAa,oBAAb;AACAJ,gBAAIK,YAAJ;AACAL,gBAAIE,KAAJ,CAAU,GAAV;AACAF,gBAAIM,aAAJ,CAAkBL,SAASJ,cAAT,CAAwB,QAAxB,CAAlB;AACAG,gBAAIE,KAAJ,CAAU,QAAV;AACH;AA/DsE,KAA5D,C","file":"DraftIndicator.js","sourcesContent":["import Label from \"sap/m/Label\";\r\nimport Control from \"sap/ui/core/Control\";\r\nimport sapui from \"sap/ui/Global\"\r\nimport jQuery from \"jquery.sap.global\";\r\n\r\nconst oBundle = sapui.getCore().getLibraryResourceBundle(\"sap.m\"),\r\n    sSaving = oBundle.getText(\"DRAFT_INDICATOR_SAVING_DRAFT\"),\r\n    sSaved = oBundle.getText(\"DRAFT_INDICATOR_DRAFT_SAVED\");\r\n\r\nconst fnStateToText = sState => {\r\n    switch (sState) {\r\n        case \"Saved\":\r\n            return sSaved;\r\n        case \"Saving\":\r\n            return sSaving;\r\n        default:\r\n            return \"\";\r\n    }\r\n};\r\n\r\nexport default Control.extend(\"spet.sbwo.web.private.util.DraftIndicator\", {\r\n    metadata: {\r\n        properties: {\r\n            delay: {\r\n                type: \"int\",\r\n                defaultValue: 1000\r\n            },\r\n            state: {\r\n                type: \"sap.m.DraftIndicatorState\",\r\n                defaultValue: \"Clear\"\r\n            }\r\n        },\r\n        aggregations: {\r\n            \"_label\": {\r\n                type: \"sap.m.Label\",\r\n                multiple: false,\r\n                visibility: \"hidden\"\r\n            }\r\n        }\r\n    },\r\n\r\n    _queued: false,\r\n    _ts: 0,\r\n    _oldState: \"\",\r\n\r\n    init() {\r\n        this.setAggregation(\"_label\", new Label());\r\n        this._ts = new Date().getTime();\r\n    },\r\n\r\n    setState(sState) {\r\n        let iTs = new Date().getTime(),\r\n            iDelay = this.getDelay();\r\n        this.setProperty(\"state\", sState);\r\n        if (!this._queued) {\r\n            if (iTs - this._ts > iDelay) {\r\n                this._updateLabel();\r\n            } else {\r\n                this._queued = true;\r\n                jQuery.sap.delayedCall(iDelay - (iTs - this._ts), this, this._updateLabel);\r\n            }\r\n        }\r\n    },\r\n\r\n    _updateLabel() {\r\n        let sState = this.getState(),\r\n            oLabel = this.getAggregation(\"_label\");\r\n        this._queued = false;\r\n        if (this._oldState !== sState) {\r\n            this._ts = new Date().getTime();\r\n        }\r\n        this._oldState = sState;\r\n        oLabel.setText(fnStateToText(sState));\r\n    },\r\n\r\n    renderer(oRm, oControl) {\r\n        oRm.write(\"<div\");\r\n        oRm.writeControlData(oControl);\r\n        oRm.addClass(\"sapMDraftIndicator\");\r\n        oRm.writeClasses();\r\n        oRm.write(\">\");\r\n        oRm.renderControl(oControl.getAggregation(\"_label\"));\r\n        oRm.write(\"</div>\");\r\n    }\r\n});\r\n"]}